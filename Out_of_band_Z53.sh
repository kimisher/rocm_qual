#!/bin/bash

clear

reading ()
{

echo "=================================================================="
echo "                   System sensor reading check"
echo "=================================================================="
echo ""
echo "The following five items are included in this script"
echo ""
echo "1. Read Power consumption from all power supplies"
echo "2. Fan speed from all system fans"
echo "3. External temperature sensor of each GPU card over SMBus"
echo "4. Internal temperature readings of each GPU ASIC over SMBus"
echo "5. Internal temperature readings of each GPU HBM Memory over SMBus"
echo "q. Exit"
echo ""
read -p "Please Enter the Test number you want to execute:  " a



if [ $a = 1 ]
then

	Power=$(ipmitool raw 0x2c 0x02 0xdc 0x01 0x00 0x00)
	printf "$Power \n"


	
elif [ $a = 2 ]
then

	ipmitool sdr list | grep RPM


elif [ $a = 3 ]
then


#	Sensor off
	ipmitool raw 0x2e 0x10 0x0a 0x3c 0x00 0x04 0x00 > /dev/null

#	LocateGPU1
	ipmitool raw 0x06 0x52 0x09 0xe2 0x00 0x40 > /dev/null
#	ipmitool raw 0x06 0x52 0x09 0xee 0x00 0x80 > /dev/null
#	ipmitool raw 0x06 0x52 0x09 0xec 0x00 0x01 > /dev/null
#	Read Temperature
	ExternalTemp=$(ipmitool raw 0x06 0x52 0x09 0xac 0x01 0x11 0x7f) && printf "GPU1 Temperature : $((16#${ExternalTemp:1})) C \n" || echo Error!!Unable to Read GPU1
#	DisableGPU1
#	ipmitool raw 0x06 0x52 0x09 0xec 0x00 0x00 > /dev/null
#	ipmitool raw 0x06 0x52 0x09 0xee 0x00 0x00 > /dev/null
	ipmitool raw 0x06 0x52 0x09 0xe2 0x00 0x00 


#	LocateGPU2
	ipmitool raw 0x06 0x52 0x03 0xe6 0x00 0x01 > /dev/null
#	Read Temperature
	ExternalTemp=$(ipmitool raw 0x06 0x52 0x03 0xac 0x01 0x11 0x7f) && printf "GPU2 Temperature : $((16#${ExternalTemp:1})) C \n" || echo Error!!Unable to Read GPU2
#	DisableGPU2
	ipmitool raw 0x06 0x52 0x03 0xe6 0x00 0x00 


#	LocateGPU3
	ipmitool raw 0x06 0x52 0x03 0xe6 0x00 0x10 > /dev/null
#	Read Temperature
	ExternalTemp=$(ipmitool raw 0x06 0x52 0x03 0xac 0x01 0x11 0x7f) && printf "GPU3 Temperature : $((16#${ExternalTemp:1})) C \n" || echo Error!!Unable to Read GPU3
#	DisableGPU3
	ipmitool raw 0x06 0x52 0x03 0xe6 0x00 0x00 


#	LocateGPU4
	ipmitool raw 0x06 0x52 0x03 0xe6 0x00 0x02 > /dev/null
#	Read Temperature
	ExternalTemp=$(ipmitool raw 0x06 0x52 0x03 0xac 0x01 0x11 0x7f) && printf "GPU4 Temperature : $((16#${ExternalTemp:1})) C \n" || echo Error!!Unable to Read GPU4
#	DisableGPU4
	ipmitool raw 0x06 0x52 0x03 0xe6 0x00 0x00 

#	LocateGPU5
	ipmitool raw 0x06 0x52 0x9 0xe2 0x00 0x20 > /dev/null
#	Read Temperature
	ExternalTemp=$(ipmitool raw 0x06 0x52 0x09 0xac 0x01 0x11 0x7f) && printf "GPU5 Temperature : $((16#${ExternalTemp:1})) C \n" || echo Error!!Unable to Read GPU5
#	DisableGPU5
	ipmitool raw 0x06 0x52 0x09 0xe2 0x00 0x00 

#	LocateGPU6
	ipmitool raw 0x06 0x52 0x03 0xe6 0x00 0x08 > /dev/null
#	Read Temperature
	ExternalTemp=$(ipmitool raw 0x06 0x52 0x03 0xac 0x01 0x11 0x7f) && printf "GPU6 Temperature : $((16#${ExternalTemp:1})) C \n" || echo Error!!Unable to Read GPU6
#	DisableGPU6
	ipmitool raw 0x06 0x52 0x03 0xe6 0x00 0x00 

#	LocateGPU7
#	ipmitool raw 0x06 0x52 0x09 0xe2 0x00 0x00 > /dev/null
	ipmitool raw 0x06 0x52 0x09 0xe2 0x00 0x10 > /dev/null
#	sleep 1
#	Read Temperature
	ExternalTemp=$(ipmitool raw 0x06 0x52 0x09 0xac 0x01 0x11 0x7f) && printf "GPU7 Temperature : $((16#${ExternalTemp:1})) C \n" || echo Error!!Unable to Read GPU7	
#	DisableGPU7
	ipmitool raw 0x06 0x52 0x09 0xe2 0x00 0x00 > /dev/null

#	LocateGPU8
	ipmitool raw 0x06 0x52 0x03 0xea 0x00 0x01 
#	Read Temperature
	ExternalTemp=$(ipmitool raw 0x06 0x52 0x03 0xac 0x01 0x11 0x7f) && printf "GPU8 Temperature : $((16#${ExternalTemp:1})) C \n" || echo Error!!Unable to Read GPU8
#	DisableGPU8
	ipmitool raw 0x06 0x52 0x03 0xea 0x00 0x00 

#	Sensor on
	ipmitool raw 0x2e 0x10 0x0a 0x3c 0x00 0x04 0x01 > /dev/null

elif [ $a = 4 ]
then


#	Sensor off
	ipmitool raw 0x2e 0x10 0x0a 0x3c 0x00 0x04 0x00 > /dev/null

#	LocateGPU1
	ipmitool raw 0x06 0x52 0x09 0xe2 0x00 0x20 > /dev/null
#	ipmitool raw 0x06 0x52 0x09 0xee 0x00 0x80 > /dev/null
#	ipmitool raw 0x06 0x52 0x09 0xec 0x00 0x01 > /dev/null
#	Unlock FPGA
	UnlockFPGA=$(ipmitool raw 0x06 0x52 0x09 0xac 0x00 0x10 0x02 0x23 0x38 0x62 0x2f 0x4c 0x31 0x6e 0x5e) || echo Error!!Unable to Unlock FPGA of GPU1
#	Read Temperature
	InternalTempASIC=$(ipmitool raw 0x06 0x52 0x09 0xac 0x01 0x11 0x7a) && printf "GPU1 Temperature : $((16#${InternalTempASIC:1})) C \n" || echo Error!!Unable to Read GPU1
#	DisableGPU1
#	ipmitool raw 0x06 0x52 0x09 0xec 0x00 0x00 > /dev/null
#	ipmitool raw 0x06 0x52 0x09 0xee 0x00 0x00 > /dev/null
	ipmitool raw 0x06 0x52 0x09 0xe2 0x00 0x00 

#	LocateGPU2
	ipmitool raw 0x06 0x52 0x03 0xe6 0x00 0x01 > /dev/null
#	Unlock FPGA
	UnlockFPGA=$(ipmitool raw 0x06 0x52 0x03 0xac 0x00 0x10 0x02 0x23 0x38 0x62 0x2f 0x4c 0x31 0x6e 0x5e) || echo Error!!Unable to Unlock FPGA of GPU2
#	Read Temperature
	InternalTempASIC=$(ipmitool raw 0x06 0x52 0x03 0xac 0x01 0x11 0x7a) && printf "GPU2 Temperature : $((16#${InternalTempASIC:1})) C \n" || echo Error!!Unable to Read GPU2
#	DisableGPU2
	ipmitool raw 0x06 0x52 0x03 0xe6 0x00 0x00 

#	LocateGPU3
	ipmitool raw 0x06 0x52 0x03 0xe6 0x00 0x10 > /dev/null
#	Unlock FPGA
	UnlockFPGA=$(ipmitool raw 0x06 0x52 0x03 0xac 0x00 0x10 0x02 0x23 0x38 0x62 0x2f 0x4c 0x31 0x6e 0x5e) || echo Error!!Unable to Unlock FPGA of GPU3
#	Read Temperature
	InternalTempASIC=$(ipmitool raw 0x06 0x52 0x03 0xac 0x01 0x11 0x7a) && printf "GPU3 Temperature : $((16#${InternalTempASIC:1})) C \n" || echo Error!!Unable to Read GPU3
#	DisableGPU3
	ipmitool raw 0x06 0x52 0x03 0xe6 0x00 0x00 

#	LocateGPU4
	ipmitool raw 0x06 0x52 0x03 0xe6 0x00 0x02 > /dev/null
#	Unlock FPGA
	UnlockFPGA=$(ipmitool raw 0x06 0x52 0x03 0xac 0x00 0x10 0x02 0x23 0x38 0x62 0x2f 0x4c 0x31 0x6e 0x5e) || echo Error!!Unable to Unlock FPGA of GPU4
#	Read Temperature
	InternalTempASIC=$(ipmitool raw 0x06 0x52 0x03 0xac 0x01 0x11 0x7a) && printf "GPU4 Temperature : $((16#${InternalTempASIC:1})) C \n" || echo Error!!Unable to Read GPU4
#	DisableGPU4
	ipmitool raw 0x06 0x52 0x03 0xe6 0x00 0x00 

#	LocateGPU5
	ipmitool raw 0x06 0x52 0x09 0xe2 0x00 0x40 > /dev/null
#	Unlock FPGA
	UnlockFPGA=$(ipmitool raw 0x06 0x52 0x09 0xac 0x00 0x10 0x02 0x23 0x38 0x62 0x2f 0x4c 0x31 0x6e 0x5e) || echo Error!!Unable to Unlock FPGA of GPU5
#	Read Temperature
	InternalTempASIC=$(ipmitool raw 0x06 0x52 0x09 0xac 0x01 0x11 0x7a) && printf "GPU5 Temperature : $((16#${InternalTempASIC:1})) C \n" || echo Error!!Unable to Read GPU5
#	DisableGPU5
	ipmitool raw 0x06 0x52 0x09 0xe2 0x00 0x00 

#	LocateGPU6
	ipmitool raw 0x06 0x52 0x03 0xe6 0x00 0x08 > /dev/null
#	Unlock FPGA
	UnlockFPGA=$(ipmitool raw 0x06 0x52 0x03 0xac 0x00 0x10 0x02 0x23 0x38 0x62 0x2f 0x4c 0x31 0x6e 0x5e) || echo Error!!Unable to Unlock FPGA of GPU6
#	Read Temperature
	InternalTempASIC=$(ipmitool raw 0x06 0x52 0x03 0xac 0x01 0x11 0x7a) && printf "GPU6 Temperature : $((16#${InternalTempASIC:1})) C \n" || echo Error!!Unable to Read GPU6
#	DisableGPU6
	ipmitool raw 0x06 0x52 0x03 0xe6 0x00 0x00 

#	LocateGPU7
	ipmitool raw 0x06 0x52 0x09 0xe2 0x00 0x10 > /dev/null
#	Unlock FPGA
	UnlockFPGA=$(ipmitool raw 0x06 0x52 0x09 0xac 0x00 0x10 0x02 0x23 0x38 0x62 0x2f 0x4c 0x31 0x6e 0x5e) || echo Error!!Unable to Unlock FPGA of GPU7
#	Read Temperature
	InternalTempASIC=$(ipmitool raw 0x06 0x52 0x09 0xac 0x01 0x11 0x7a) && printf "GPU7 Temperature : $((16#${InternalTempASIC:1})) C \n" || echo Error!!Unable to Read GPU7	
#	DisableGPU7
	ipmitool raw 0x06 0x52 0x09 0xe2 0x00 0x00

#	LocateGPU8
	ipmitool raw 0x06 0x52 0x03 0xea 0x00 0x01 > /dev/null
#	Unlock FPGA
	UnlockFPGA=$(ipmitool raw 0x06 0x52 0x03 0xac 0x00 0x10 0x02 0x23 0x38 0x62 0x2f 0x4c 0x31 0x6e 0x5e) || echo Error!!Unable to Unlock FPGA of GPU8
#	Read Temperature
	InternalTempASIC=$(ipmitool raw 0x06 0x52 0x03 0xac 0x01 0x11 0x7a) && printf "GPU8 Temperature : $((16#${InternalTempASIC:1})) C \n" || echo Error!!Unable to Read GPU8
#	DisableGPU8
	ipmitool raw 0x06 0x52 0x03 0xea 0x00 0x00 

#	Sensor on
	ipmitool raw 0x2e 0x10 0x0a 0x3c 0x00 0x04 0x01 > /dev/null

elif [ $a = 5 ]
then


#	Sensor off
	ipmitool raw 0x2e 0x10 0x0a 0x3c 0x00 0x04 0x00 > /dev/null

#	LocateGPU1
	ipmitool raw 0x06 0x52 0x09 0xe2 0x00 0x20 > /dev/null
#	ipmitool raw 0x06 0x52 0x09 0xee 0x00 0x80 > /dev/null
#	ipmitool raw 0x06 0x52 0x09 0xec 0x00 0x01 > /dev/null
#	Read Temperature
	InternalTempHBM=$(ipmitool raw 0x06 0x52 0x09 0xac 0x01 0x11 0x7d) && printf "GPU1 Temperature : $((16#${InternalTempHBM:1})) C \n" || echo Error!!Unable to Read GPU1
#	DisableGPU1
#	ipmitool raw 0x06 0x52 0x09 0xec 0x00 0x00 > /dev/null
#	ipmitool raw 0x06 0x52 0x09 0xee 0x00 0x00 > /dev/null
	ipmitool raw 0x06 0x52 0x09 0xe2 0x00 0x00 

#	LocateGPU2
	ipmitool raw 0x06 0x52 0x03 0xe6 0x00 0x01 > /dev/null
#	Read Temperature
	InternalTempHBM=$(ipmitool raw 0x06 0x52 0x03 0xac 0x01 0x11 0x7d) && printf "GPU2 Temperature : $((16#${InternalTempHBM:1})) C \n" || echo Error!!Unable to Read GPU2
#	DisableGPU2
	ipmitool raw 0x06 0x52 0x03 0xe6 0x00 0x00 

#	LocateGPU3
	ipmitool raw 0x06 0x52 0x03 0xe6 0x00 0x10 > /dev/null
#	Read Temperature
	InternalTempHBM=$(ipmitool raw 0x06 0x52 0x03 0xac 0x01 0x11 0x7d) && printf "GPU3 Temperature : $((16#${InternalTempHBM:1})) C \n" || echo Error!!Unable to Read GPU3
#	DisableGPU3
	ipmitool raw 0x06 0x52 0x03 0xe6 0x00 0x00 

#	LocateGPU4
	ipmitool raw 0x06 0x52 0x03 0xe6 0x00 0x02 > /dev/null
#	Read Temperature
	InternalTempHBM=$(ipmitool raw 0x06 0x52 0x03 0xac 0x01 0x11 0x7d) && printf "GPU4 Temperature : $((16#${InternalTempHBM:1})) C \n" || echo Error!!Unable to Read GPU4
#	DisableGPU4
	ipmitool raw 0x06 0x52 0x03 0xe6 0x00 0x00 

#	LocateGPU5
	ipmitool raw 0x06 0x52 0x09 0xe2 0x00 0x40 > /dev/null
#	Read Temperature
	InternalTempHBM=$(ipmitool raw 0x06 0x52 0x09 0xac 0x01 0x11 0x7d) && printf "GPU5 Temperature : $((16#${InternalTempHBM:1})) C \n" || echo Error!!Unable to Read GPU5
#	DisableGPU5
	ipmitool raw 0x06 0x52 0x09 0xe2 0x00 0x00 

#	LocateGPU6
	ipmitool raw 0x06 0x52 0x03 0xe6 0x00 0x08 > /dev/null
#	Read Temperature
	InternalTempHBM=$(ipmitool raw 0x06 0x52 0x03 0xac 0x01 0x11 0x7d) && printf "GPU6 Temperature : $((16#${InternalTempHBM:1})) C \n" || echo Error!!Unable to Read GPU6
#	DisableGPU6
	ipmitool raw 0x06 0x52 0x03 0xe6 0x00 0x00 

#	LocateGPU7
	ipmitool raw 0x06 0x52 0x09 0xe2 0x00 0x10 > /dev/null
#	Read Temperature
	InternalTempHBM=$(ipmitool raw 0x06 0x52 0x09 0xac 0x01 0x11 0x7d) && printf "GPU7 Temperature : $((16#${InternalTempHBM:1})) C \n" || echo Error!!Unable to Read GPU7	
#	DisableGPU7
	ipmitool raw 0x06 0x52 0x09 0xe2 0x00 0x00 > /dev/null

#	LocateGPU8
	ipmitool raw 0x06 0x52 0x03 0xea 0x00 0x01 
#	Read Temperature
	InternalTempHBM=$(ipmitool raw 0x06 0x52 0x03 0xac 0x01 0x11 0x7d) && printf "GPU8 Temperature : $((16#${InternalTempHBM:1})) C \n" || echo Error!!Unable to Read GPU8
#	DisableGPU8
	ipmitool raw 0x06 0x52 0x03 0xea 0x00 0x00 

#	Sensor on
	ipmitool raw 0x2e 0x10 0x0a 0x3c 0x00 0x04 0x01 > /dev/null

else
	echo "Please Enter the right number!"
	read -s -n1 -p "Press any key to continue..."
	clear
	reading
fi

}


#locateGPU(){

#	for((i=1;i<=8;i++))
#		do
#			echo $i	
#		done



#}


reading



